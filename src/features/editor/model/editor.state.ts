import type {Editor} from "@tiptap/core";
import type {EditorStateSnapshot} from "@tiptap/react";

/**
 * State selector for the ToolBar component.
 * Extracts the relevant editor state for rendering menu buttons.
 */

export type EditorStateType = {
  isBold: boolean;
  canBold: boolean;
  isItalic: boolean;
  canItalic: boolean;
  isStrike: boolean;
  canStrike: boolean;
  isCode: boolean;
  canCode: boolean;
  canClearMarks: boolean;
  isParagraph: boolean;
  isHeading1: boolean;
  isHeading2: boolean;
  isHeading3: boolean;
  isBulletList: boolean;
  isOrderedList: boolean;
  isCodeBlock: boolean;
  isBlockquote: boolean;
  canUndo: boolean;
  canRedo: boolean;
  isTextAlignLeft: boolean;
  isTextAlignCenter: boolean;
  isTextAlignRight: boolean;
  isTextAlignJustify: boolean;
};

export function toolBarStateSelector(
  ctx: EditorStateSnapshot<Editor>,
): EditorStateType | null {
  if (ctx.editor == null) return null;

  return {
    // Text formatting
    isBold: ctx.editor.isActive("bold") ?? false,
    canBold: ctx.editor.can().chain().toggleBold().run() ?? false,
    isItalic: ctx.editor.isActive("italic") ?? false,
    canItalic: ctx.editor.can().chain().toggleItalic().run() ?? false,
    isStrike: ctx.editor.isActive("strike") ?? false,
    canStrike: ctx.editor.can().chain().toggleStrike().run() ?? false,
    isCode: ctx.editor.isActive("code") ?? false,
    canCode: ctx.editor.can().chain().toggleCode().run() ?? false,
    canClearMarks: ctx.editor.can().chain().unsetAllMarks().run() ?? false,

    // Block types
    isParagraph: ctx.editor.isActive("paragraph") ?? false,
    isHeading1: ctx.editor.isActive("heading", {level: 1}) ?? false,
    isHeading2: ctx.editor.isActive("heading", {level: 2}) ?? false,
    isHeading3: ctx.editor.isActive("heading", {level: 3}) ?? false,

    // Lists and blocks
    isBulletList: ctx.editor.isActive("bulletList") ?? false,
    isOrderedList: ctx.editor.isActive("orderedList") ?? false,
    isCodeBlock: ctx.editor.isActive("codeBlock") ?? false,
    isBlockquote: ctx.editor.isActive("blockquote") ?? false,

    // History
    canUndo: ctx.editor.can().chain().undo().run() ?? false,
    canRedo: ctx.editor.can().chain().redo().run() ?? false,

    // Text Align
    isTextAlignLeft: ctx.editor.isActive({textAlign: "left"}) ?? false,
    isTextAlignCenter: ctx.editor.isActive({textAlign: "center"}) ?? false,
    isTextAlignRight: ctx.editor.isActive({textAlign: "right"}) ?? false,
    isTextAlignJustify: ctx.editor.isActive({textAlign: "justify"}) ?? false,
  };
}

export type MenuBarState = ReturnType<typeof toolBarStateSelector>;
